{% extends 'base.html' %}
{% block content %}
<div class="dashboard-welcome">
 <h2>Welcome, {{ name }}ğŸ’•
  {% if session.get('guest') %}
    <span class="badge ">
     <span class="badge border-5 rounded p-2 " style="border: 2px solid;border-color: #a8e7faa9; color: #0d2e5c; font-size: 0.6em; vertical-align: middle;">
      Guest Mode - 30 Days Free
     </span>
    </span>
  {% endif %}
</h2>

{% if session.get('guest') %}
<div class="alert-info mt-3">
    <div class="alert" style="background-color: #dbeeff4d; color: #16335e;">
    <strong>Guest Mode Active!</strong>
     Enjoy your 30-day ride, Want to stick around? Sign up and save your progress!
    <div class="mt-2">
        <a href="{{ url_for('register') }}" class="btn btn-sm btn-outline-primary me-2">
            Create Account for Email Reminders
        </a>
        <a href="{{ url_for('home') }}" class="btn btn-sm btn-outline-secondary">
            Learn More About Eva
        </a>
    </div>
</div>
{% endif %}
</div>

{% if next_period %}
<div class="next-period-card">
    <strong>ğŸ—“ï¸ Next Predicted Period:</strong>
    <div style="font-size: 1.4rem; font-weight: 600; color: #495057; margin-top: 0.5rem;">
        {{ next_period.strftime('%d %B %Y') }}
    </div>
    <small style="color: #6c757d; margin-top: 0.5rem; display: block;">
        {% if session.get('guest') %}
        Prediction based on your tracked cycles. Create an account for email reminders!
        {% else %}
        Stay prepared! We'll remind you 3 days before.
        {% endif %}
    </small>
</div>
{% endif %}

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h4 style="margin: 0; color: #495057;">ğŸ“Š Your Cycle History</h4>
    <a href="{{ url_for('track') }}" class="btn btn-success" style="text-decoration: none;">
        + Add New Cycle
    </a>
</div>

{% if logs %}
<table class="table table-hover">
    <thead>
        <tr>
            <th>ğŸ“… Start Date</th>
            <th>ğŸ End Date</th>
            <th>â±ï¸ Length</th>
            <th>ğŸ“ Notes</th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr>
            <td style="font-weight: 500;">{{ log['start_date'] | datetimeformat }}</td>
            <td style="font-weight: 500;">{{ log['end_date'] | datetimeformat }}</td>
            <td>
                <span style="background: linear-gradient(45deg, #a8e6cf, #dcedc1); padding: 0.3rem 0.8rem; border-radius: 15px; font-weight: 600;">
                    {{ log['length'] }} days
                </span>
            </td>
            <td style="color: #6c757d; font-style: italic;">
                {{ log['note'] if log['note'] else 'No notes' }}
                  <form method="post" action="{{ url_for('delete_cycle', cycle_id=log['id']) }}" onsubmit="return confirm('Are you sure you want to delete this cycle?');" style="margin-top: 0.5rem;">
                     <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                 </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if session.get('guest') and logs|length >= 2 %}
<div style="background: linear-gradient(135deg, #c8a2c8, #e6d7ff); padding: 1.5rem; border-radius: 15px; margin-top: 2rem; text-align: center;">
    <h6 style="color: #2d3436; margin-bottom: 1rem;">ğŸ’¡ Personalized Insights Available!</h6>
    <p style="color: #636e72; margin-bottom: 1rem;">
        Great job tracking {{ logs|length }} cycles! Eva can now provide better predictions and insights.
        Create an account to unlock email reminders and never miss a period again.
    </p>
    <a href="{{ url_for('register') }}" class="btn btn-primary btn-sm">
        Upgrade to Full Account
    </a>
</div>
{% endif %}

{% else %}
<div style="text-align: center; padding: 3rem; background: rgba(255,251,240,0.6); border-radius: 15px; margin-top: 2rem;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸŒ¸</div>
    <h5 style="color: #6c757d; margin-bottom: 1rem;">No cycles tracked yet</h5>
    <p style="color: #6c757d; margin-bottom: 2rem;">
        {% if session.get('guest') %}
        Start tracking your periods to get personalized predictions! Your data will be saved for 30 days.
        {% else %}
        Start tracking your periods to get personalized predictions and insights!
        {% endif %}
    </p>
    <a href="{{ url_for('track') }}" class="btn btn-primary" style="text-decoration: none;">
        Track Your First Cycle
    </a>
</div>
{% endif %}

{% if session.get('guest') %}
<div style="background: linear-gradient(135deg, #ffcc99, #ffe4cc); padding: 2rem; border-radius: 20px; text-align: center; margin-top: 3rem; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
    <h5 style="color: #2d3436; margin-bottom: 1rem;">ğŸŒŸ Enjoying Eva?</h5>
    <p style="color: #636e72; margin-bottom: 1.5rem;">
        Your guest session gives you full access for 30 days. Create a free account to keep your data forever and get email reminders!
    </p>
    <div>
        <a href="{{ url_for('register') }}" class="btn btn-primary me-2" style="text-decoration: none;">
            Create Free Account
        </a>
        <a href="{{ url_for('home') }}" class="btn btn-outline-secondary" style="text-decoration: none; border-color: #636e72; color: #636e72;">
            Learn More
        </a>
    </div>
</div>
{% endif %}
{% endblock %}